const cart = {};
let cartFilled = false;
let cartOpened = false;
let upsellItemsInCart = 0;
let upsellItemsAvailable = upsellProducts.filter((upsellItem) => upsellItem.variants[0].available).length;

const cartPopupItemClass = "cart-popup-item";
const itemClasses = {
  wrapper: `${cartPopupItemClass}-wrapper`,
  checkout: `cart-popup-checkout`,
  upsell: `cart-upsell`,
  controls: `${cartPopupItemClass}-controls`,
  title: `${cartPopupItemClass}-title`,
  amount: `${cartPopupItemClass}-amount`,
  property: `${cartPopupItemClass}-property`,
  flavor: `${cartPopupItemClass}-flavor`,
  size: `${cartPopupItemClass}-size`,
  quantity: `${cartPopupItemClass}-quantity`,
  increaseQuantity: `${cartPopupItemClass}-increase-quantity`,
  decreaseQuantity: `${cartPopupItemClass}-decrease-quantity`,
  remove: `${cartPopupItemClass}-remove`,
  image: `${cartPopupItemClass}-image`,
  price: `${cartPopupItemClass}-price`,
};

const $cartSelectors = {
  $headerCartButton: () => {
    return $(`.site-nav__link__cart`);
  },
  $closeCartButton: () => {
    return $(`.cart-popup__close`);
  },
};

const $itemSelectors = {
  $itemsWrapper: () => {
    return $(`.${itemClasses.wrapper}`);
  },
  $item: (id) => {
    return $(`[${id}]`);
  },
  $itemByKey: (key) => {
    return $(`[key='${key}']`);
  },
  $quantity: (key) => {
    return $(`[key='${key}'] > .${itemClasses.controls} .${itemClasses.quantity}`);
  },
  $increaseQuantity: (key) => {
    return $(`[key='${key}'] > .${itemClasses.controls} .${itemClasses.increaseQuantity}`);
  },
  $decreaseQuantity: (key) => {
    return $(`[key='${key}'] > .${itemClasses.controls} .${itemClasses.decreaseQuantity}`);
  },
  $remove: (key) => {
    return $(`[key='${key}'] > .${itemClasses.controls} > .${itemClasses.remove}`);
  },
};
 

const cartEvents = {
  item: {
    addToCart: "addItemAddToCartBtn",
    remove: "removeItem",
    increaseQty: "increaseItemQuantity",
    decreaseQty: "decreaseItemQuantity",
  },
  upsell: {
    addToCart: "upsellAddToCart",
    removedFromCart: "upsellRemovedFromCart",
    upsellIsEmpty: "upsellIsEmpty",
    upsellIsNoLongerEmpty: "upsellIsNoLongerEmpty",
    nextItem: "upsellNextItem",
    previtem: "upsellPrevItem",
  }
};

// TOD:
// populate cart object with the actual retrieved cart
// and also calculate upsellItemsIncart at the same time
getCart(populateCartObject);

document.addEventListener("DOMContentLoaded", (event) => {
 
  $cartSelectors.$headerCartButton().click((event) => {
    cartPopupShowEvent(event);
    //arrows
  });

  $cartSelectors.$closeCartButton().click((event) => {
    event.preventDefault();
    hideCartPopup();
  });

  $(document).on(cartEvents.item.increaseQty, (e, { itemKEY }) => {
    cartIncreaseItemQuantityEvent(itemKEY);
  });

  $(document).on(cartEvents.item.decreaseQty, (e, { itemKEY }) => {
    cartDecreaseItemQuantityEvent(itemKEY);
  });

  $(document).on(cartEvents.item.remove, (e, { itemKEY }) => {
    cartRemoveItemEvent(itemKEY);
  });

  $(document).on(cartEvents.item.addToCart, (e, item) => {
    cartAddItemEvent(item);
    //arrows
  });

  $('.cart-popup-checkout-button a').click(() => {
  	localStorage.setItem("checkout-back", "true"); 
  })  


  $(window).resize((e, data) => {
    cartOpened && setNewHeightForVisibleItemsInCartOnResize($itemSelectors.$itemsWrapper(), data);
  });
});
